<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o da Plataforma Konclu√≠</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>üìä Konclu√≠</h1>
                <p class="subtitle">Pesquisa de Satisfa√ß√£o</p>
                <p class="description">Sua opini√£o √© fundamental para continuarmos evoluindo nossa plataforma de gest√£o para restaurantes</p>
            </div>
        </div>
        
        <div class="form-content">
            <form id="feedbackForm" novalidate>
                <div class="form-section">
                    <h3>üîç Informa√ß√µes B√°sicas</h3>
                    
                    <div class="form-group">
                        <label>Qual √© o seu perfil na plataforma Konklui? <span class="required">*</span></label>
                        <div class="user-type-selector">
                            <div class="user-type-option">
                                <input type="radio" id="gestor" name="userType" value="Gestor/Propriet√°rio" required>
                                <div class="user-type-card" onclick="selectUserType('gestor')">
                                    <span class="icon">üë©‚Äçüíºüë®‚Äçüíº</span>
                                    <div class="title">Gestor/Gerente</div>
                                    <div class="description">Configuro checklists, usu√°rios e unidades</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Nome: <span class="required">*</span></label>
                        <input type="text" id="name" name="name" placeholder="Seu nome" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="restaurant">Nome do Restaurante:</label>
                        <input type="text" id="restaurant" name="restaurant" placeholder="Nome do seu restaurante">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email para contato:</label>
                        <input type="email" id="email" name="email" placeholder="seu.email@exemplo.com">
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚≠ê Avalia√ß√£o Geral</h3>
                    
                    <div class="form-group">
                        <label>Como voc√™ avalia a plataforma Konklui no geral? <span class="required">*</span></label>
                        <div class="rating-container">
                            <div class="star-rating" id="overallRating">
                                <span class="star" data-rating="1">‚≠ê</span>
                                <span class="star" data-rating="2">‚≠ê</span>
                                <span class="star" data-rating="3">‚≠ê</span>
                                <span class="star" data-rating="4">‚≠ê</span>
                                <span class="star" data-rating="5">‚≠ê</span>
                            </div>
                            <span class="rating-text" id="ratingText">Clique nas estrelas</span>
                        </div>
                        <input type="hidden" name="avaliacao_geral" id="ratingValue" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Qu√£o f√°cil √© usar o Konklui no seu dia a dia? <span class="required">*</span></label>
                        <div class="emoji-scale" id="usabilityScale">
                            <div class="emoji-option" data-value="1">
                                <span class="emoji">üò´</span>
                                <div class="emoji-text">Muito Dif√≠cil</div>
                            </div>
                            <div class="emoji-option" data-value="2">
                                <span class="emoji">üòï</span>
                                <div class="emoji-text">Dif√≠cil</div>
                            </div>
                            <div class="emoji-option" data-value="3">
                                <span class="emoji">üòê</span>
                                <div class="emoji-text">Regular</div>
                            </div>
                            <div class="emoji-option" data-value="4">
                                <span class="emoji">üòä</span>
                                <div class="emoji-text">F√°cil</div>
                            </div>
                            <div class="emoji-option" data-value="5">
                                <span class="emoji">üòç</span>
                                <div class="emoji-text">Muito F√°cil</div>
                            </div>
                        </div>
                        <input type="hidden" name="facilidade_uso" id="usabilityValue" required>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üõ†Ô∏è Funcionalidades</h3>
                    
                    <div class="form-group">
                        <label>Quais funcionalidades voc√™ mais utiliza? (marque todas que se aplicam)</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="checklist-creation" name="features" value="Cria√ß√£o de Checklists">
                                <label for="checklist-creation">Cria√ß√£o de Checklists</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dashboard" name="features" value="Painel Dashboard">
                                <label for="dashboard">Painel Dashboard</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="user-management" name="features" value="Gest√£o de Usu√°rios">
                                <label for="user-management">Gest√£o de Usu√°rios</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="unit-management" name="features" value="Gest√£o de Unidades">
                                <label for="unit-management">Gest√£o de Unidades</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="sector-management" name="features" value="Gest√£o de Setores">
                                <label for="sector-management">Gest√£o de Setores</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="checklist-answers" name="features" value="Conferir respostas do Checklist">
                                <label for="checklist-answers">Conferir respostas do Checklist</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="notifications" name="features" value="Notifica√ß√µes">
                                <label for="notifications">Notifica√ß√µes</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üí≠ Feedback Detalhado</h3>
                    
                    <div class="form-group">
                        <label for="mostLiked">O que voc√™ mais gosta no Konklui?</label>
                        <textarea id="mostLiked" name="mostLiked" placeholder="Conte-nos o que funciona bem e facilita seu trabalho no restaurante..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="improvements">O que voc√™ gostaria que fosse melhorado?</label>
                        <textarea id="improvements" name="improvements" placeholder="Descreva funcionalidades que poderiam ser melhoradas, novos recursos que facilitariam sua rotina, ou dificuldades que encontra..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeImpact">Como o Konklui impactou a gest√£o do seu restaurante?</label>
                        <textarea id="timeImpact" name="timeImpact" placeholder="Por exemplo: economizou tempo, melhorou a organiza√ß√£o, facilitou o controle de qualidade..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üéØ Recomenda√ß√£o</h3>
                    
                    <div class="form-group">
                        <label for="recommendation">Voc√™ recomendaria o Konklui para outros restaurantes?</label>
                        <select id="recommendation" name="recommendation">
                            <option value="">Selecione uma op√ß√£o</option>
                            <option value="Definitivamente sim">Definitivamente sim</option>
                            <option value="Provavelmente sim">Provavelmente sim</option>
                            <option value="Talvez">Talvez</option>
                            <option value="Provavelmente n√£o">Provavelmente n√£o</option>
                            <option value="Definitivamente n√£o">Definitivamente n√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalComments">Coment√°rios adicionais:</label>
                        <textarea id="additionalComments" name="additionalComments" placeholder="Qualquer outra observa√ß√£o sobre sua experi√™ncia com o Konklui..."></textarea>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">Enviar Avalia√ß√£o</button>
                
                <div class="success-message" id="successMessage">
                    ‚úÖ Obrigado pelo seu feedback! Sua opini√£o nos ajuda a melhorar o Konklui continuamente.
                </div>

                <div class="error-message" id="errorMessage">
                    ‚ùå Por favor, preencha todos os campos obrigat√≥rios marcados com *.
                </div>
            </form>
        </div>
    </div>

    <script>
        const FORMSPREE_URL = 'https://formspree.io/f/mnnzrqqn';
        
        // ===== ELEMENTOS DO DOM =====
        const form = document.getElementById('feedbackForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        
        // ===== AVALIA√á√ÉO POR ESTRELAS =====
        const stars = document.querySelectorAll('.star');
        const ratingText = document.getElementById('ratingText');
        const ratingValue = document.getElementById('ratingValue');
        const ratingLabels = ['P√©ssimo', 'Ruim', 'Regular', 'Bom', 'Excelente'];
        
        let currentRating = 0;
        
        stars.forEach((star, index) => {
            star.addEventListener('click', () => {
                currentRating = index + 1;
                updateStarRating();
                ratingText.textContent = ratingLabels[index];
                ratingValue.value = `${currentRating} estrelas (${ratingLabels[index]})`;
            });
            
            star.addEventListener('mouseover', () => {
                highlightStars(index + 1);
            });
        });
        
        document.getElementById('overallRating').addEventListener('mouseleave', () => {
            updateStarRating();
        });
        
        function highlightStars(rating) {
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }
        
        function updateStarRating() {
            highlightStars(currentRating);
        }
        
        // ===== ESCALA DE EMOJIS =====
        const emojiOptions = document.querySelectorAll('.emoji-option');
        const usabilityValue = document.getElementById('usabilityValue');
        
        emojiOptions.forEach(option => {
            option.addEventListener('click', () => {
                emojiOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                
                const value = option.getAttribute('data-value');
                const text = option.querySelector('.emoji-text').textContent;
                usabilityValue.value = `${value} - ${text}`;
            });
        });
        
        // ===== SELE√á√ÉO DO TIPO DE USU√ÅRIO =====
        function selectUserType(id) {
            document.getElementById(id).checked = true;
        }
        
        // ===== VALIDA√á√ÉO DO FORMUL√ÅRIO =====
        function validateForm() {
            let isValid = true;
            const requiredFields = form.querySelectorAll('input[required], select[required]');
            
            // Limpar erros anteriores
            errorMessage.style.display = 'none';
            form.querySelectorAll('.field-error').forEach(field => {
                field.classList.remove('field-error');
            });
            
            // Verificar campos obrigat√≥rios
            requiredFields.forEach(field => {
                if (field.type === 'radio') {
                    const radioGroup = form.querySelectorAll(`input[name="${field.name}"]`);
                    const hasSelection = Array.from(radioGroup).some(radio => radio.checked);
                    if (!hasSelection) {
                        isValid = false;
                        // Destacar o card do tipo de usu√°rio
                        document.querySelector('.user-type-card').style.borderColor = '#ef4444';
                    }
                } else if (field.type === 'hidden') {
                    // Verificar campos hidden (avalia√ß√µes)
                    if (!field.value.trim()) {
                        isValid = false;
                    }
                } else if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('field-error');
                }
            });

            // Verificar formato do email se preenchido
            const emailField = document.getElementById('email');
            if (emailField.value && !isValidEmail(emailField.value)) {
                isValid = false;
                emailField.classList.add('field-error');
            }
            
            if (!isValid) {
                errorMessage.style.display = 'block';
                errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // ===== COLETA DE FUNCIONALIDADES SELECIONADAS =====
        function getSelectedFeatures() {
            const checkedBoxes = form.querySelectorAll('input[name="features"]:checked');
            return Array.from(checkedBoxes).map(checkbox => checkbox.value).join(', ');
        }
        
        // ===== ENVIO DO FORMUL√ÅRIO =====
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            const originalText = submitBtn.textContent;
            
            // Estado de carregamento
            submitBtn.textContent = 'Enviando...';
            submitBtn.disabled = true;
            form.classList.add('loading');
            
            try {
                // Preparar dados do formul√°rio
                const formData = new FormData(form);
                
                // Adicionar funcionalidades selecionadas
                const selectedFeatures = getSelectedFeatures();
                formData.append('funcionalidades_utilizadas', selectedFeatures || 'Nenhuma selecionada');
                
                // Adicionar data de envio
                formData.append('data_envio', new Date().toLocaleString('pt-BR'));
                
                // Enviar para Formspree
                const response = await fetch(FORMSPREE_URL, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    // Sucesso - mostrar mensagem
                    successMessage.style.display = 'block';
                    successMessage.scrollIntoView({ behavior: 'smooth' });
                    
                    // Resetar formul√°rio
                    form.reset();
                    currentRating = 0;
                    updateStarRating();
                    ratingText.textContent = 'Clique nas estrelas';
                    ratingValue.value = '';
                    usabilityValue.value = '';
                    emojiOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Remover destaque do card
                    document.querySelector('.user-type-card').style.borderColor = '#e2e8f0';
                    
                } else {
                    const data = await response.json();
                    throw new Error(data.error || 'Erro no envio');
                }
                
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao enviar feedback. Por favor, tente novamente.');
                
            } finally {
                // Restaurar estado do bot√£o
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                form.classList.remove('loading');
            }
        });
        
        // ===== ANIMA√á√ïES E INTERA√á√ïES =====
        
        // Anima√ß√£o de entrada das se√ß√µes
        const formSections = document.querySelectorAll('.form-section');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });
        
        formSections.forEach(section => {
            observer.observe(section);
        });
        
        // Limpar erros ao digitar
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.addEventListener('input', () => {
                input.classList.remove('field-error');
                if (input.closest('.user-type-option')) {
                    document.querySelector('.user-type-card').style.borderColor = '#e2e8f0';
                }
            });
        });
        
        // Auto-salvar rascunho (opcional - usando sessionStorage para n√£o persistir entre sess√µes)
        function saveFormData() {
            const formData = new FormData(form);
            const data = {};
            
            // Salvar dados b√°sicos
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    // Se j√° existe, converter para array (para checkboxes m√∫ltiplos)
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }
            
            // Salvar estados especiais
            data.currentRating = currentRating;
            data.selectedUsability = document.querySelector('.emoji-option.selected')?.getAttribute('data-value');
            
            sessionStorage.setItem('konklui_feedback_draft', JSON.stringify(data));
        }
        
        function loadFormData() {
            const savedData = sessionStorage.getItem('konklui_feedback_draft');
            if (!savedData) return;
            
            try {
                const data = JSON.parse(savedData);
                
                // Restaurar campos b√°sicos
                Object.keys(data).forEach(key => {
                    if (key === 'currentRating') {
                        if (data[key] && data[key] > 0) {
                            currentRating = parseInt(data[key]);
                            updateStarRating();
                            ratingText.textContent = ratingLabels[currentRating - 1];
                            ratingValue.value = `${currentRating} estrelas (${ratingLabels[currentRating - 1]})`;
                        }
                    } else if (key === 'selectedUsability') {
                        if (data[key]) {
                            const emojiOption = document.querySelector(`[data-value="${data[key]}"]`);
                            if (emojiOption) {
                                emojiOption.classList.add('selected');
                                const text = emojiOption.querySelector('.emoji-text').textContent;
                                usabilityValue.value = `${data[key]} - ${text}`;
                            }
                        }
                    } else {
                        const field = form.querySelector(`[name="${key}"]`);
                        if (field) {
                            if (field.type === 'radio') {
                                if (field.value === data[key]) {
                                    field.checked = true;
                                }
                            } else if (field.type === 'checkbox') {
                                const values = Array.isArray(data[key]) ? data[key] : [data[key]];
                                if (values.includes(field.value)) {
                                    field.checked = true;
                                }
                            } else if (field.type !== 'hidden') {
                                field.value = data[key];
                            }
                        }
                    }
                });
                
            } catch (e) {
                console.log('Erro ao carregar rascunho:', e);
            }
        }
        
        // Salvar automaticamente a cada mudan√ßa
        inputs.forEach(input => {
            input.addEventListener('change', saveFormData);
        });
        
        // Salvar ao clicar nas estrelas e emojis
        stars.forEach(star => {
            star.addEventListener('click', saveFormData);
        });
        
        emojiOptions.forEach(option => {
            option.addEventListener('click', saveFormData);
        });
        
        // Carregar dados salvos ao inicializar
        document.addEventListener('DOMContentLoaded', () => {
            loadFormData();
            
            // Auto-selecionar o tipo de usu√°rio j√° que s√≥ h√° uma op√ß√£o
            document.getElementById('gestor').checked = true;
        });
        
        // Limpar rascunho ap√≥s envio bem-sucedido
        form.addEventListener('submit', (e) => {
            if (e.defaultPrevented) return;
            
            // Aguardar um pouco antes de limpar para garantir que o envio foi processado
            setTimeout(() => {
                sessionStorage.removeItem('konklui_feedback_draft');
            }, 2000);
        });
        
        // ===== MELHORIAS DE UX =====
        
        // Feedback visual ao passar o mouse nas estrelas
        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', () => {
                ratingText.textContent = ratingLabels[index];
            });
        });
        
        document.getElementById('overallRating').addEventListener('mouseleave', () => {
            if (currentRating > 0) {
                ratingText.textContent = ratingLabels[currentRating - 1];
            } else {
                ratingText.textContent = 'Clique nas estrelas';
            }
        });
        
        // Contador de caracteres para textareas (opcional)
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('input', () => {
                const length = textarea.value.length;
                if (length > 500) {
                    textarea.style.borderColor = '#f59e0b';
                } else {
                    textarea.style.borderColor = '#e2e8f0';
                }
            });
        });
        
        // Valida√ß√£o em tempo real do email
        const emailField = document.getElementById('email');
        emailField.addEventListener('blur', () => {
            if (emailField.value && !isValidEmail(emailField.value)) {
                emailField.classList.add('field-error');
            }
        });
        
        emailField.addEventListener('input', () => {
            emailField.classList.remove('field-error');
        });
        
        // Preven√ß√£o de envio duplo
        let isSubmitting = false;
        
        form.addEventListener('submit', (e) => {
            if (isSubmitting) {
                e.preventDefault();
                return false;
            }
            isSubmitting = true;
            
            // Reset ap√≥s 5 segundos como seguran√ßa
            setTimeout(() => {
                isSubmitting = false;
            }, 5000);
        });
        
        console.log('Formul√°rio Konklui inicializado com sucesso!');
    </script>
</body>
</html>